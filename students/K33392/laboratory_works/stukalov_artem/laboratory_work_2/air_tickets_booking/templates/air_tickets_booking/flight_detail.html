{% extends 'air_tickets_booking/base.html' %} {% block content %}

<h1>Рейс {{flight.name}}</h1>

<h2>Пассажиры</h2>
<div class="row mb-5">
  <div class="col-md-5">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th scope="col">ФИО</th>
          <th scope="col">Место</th>
        </tr>
      </thead>

      <tbody>
        {% for ticket in tickets_page %}
          <tr>
            <td class="align-middle">{{ticket.passenger.first_name}}<br>{{ticket.passenger.last_name}}</td>
            <td class="align-middle">{{ticket.seat}}</td>
          </tr>
        {% endfor %} 
      </tbody>
    </table>

    <nav>
      <ul class="pagination">
        {% if tickets_page.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?tickets=1">1</a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?tickets={{ tickets_page.previous_page_number }}">Previous</a>
          </li>
        {% endif %}
    
        <li class="page-item ">
          <span class='page-link'> 
            Page {{ tickets_page.number }} of {{ tickets_page.paginator.num_pages }}.
          </span>
        </li>
    
        {% if tickets_page.has_next %}
          <li class="page-item">
            <a class="page-link" href="?tickets={{ tickets_page.next_page_number }}">Next</a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?tickets={{ tickets_page.paginator.num_pages }}">{{ tickets_page.paginator.num_pages }}</a>
          </li>
        {% endif %}
      </ul>
    </nav>
  </div>
</div>

<h2>Схема мест</h2>
<table class="table table-striped table-hover mb-5">
  <tbody>
    {% for row in seats %}
      <tr>
        {% for seat in row %}
          <td class="text-center">
            {% if seat.is_taken %}
              <s>{{seat.name}}</s>
            {% else %}
              {{seat.name}}
            {% endif %}
          </td>
        {% endfor %} 
      </tr>
    {% endfor %}
  </tbody> 
</table>

{% if not has_ticket and user.is_authenticated %}
  <h2>Забронировать билет</h2>
  <div class="row">
    <div class="col-md-3">
      <form method="POST" action="{% url 'flight_book' flight.id %}">
        {% csrf_token %}
        <div class="mb-3">
          <label for="{{booking_form.seat.id_for_label}}" class="form-label">Место</label>
          <input name='seat' class="form-control" id="{{booking_form.seat.id_for_label}}">
        </div>
        <button type="submit" class="btn btn-primary">Забронировать</button>
      </form>
    </div>
  </div>
{% endif %}


{% if user.is_authenticated %}
  <h2>Комментарии</h2>
  <div class="row">
    <div class="col-md-3 d-flex gap-3 flex-column">
      <div class="d-flex flex-column gap-3">
        {% for comment in comments_page %}
          <div class="p-3 border d-flex flex-column">
            <h5>{{comment.user.username}} ({{comment.date_time}})</h5>
            <span>
              {{comment.message}}
            </span>
          </div>
        {% endfor %}
      </div>

      <nav>
        <ul class="pagination">
          {% if comments_page.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?comments=1">1</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?comments={{ comments_page.previous_page_number }}">Previous</a>
            </li>
          {% endif %}
      
          <li class="page-item ">
            <span class='page-link'> 
              Page {{ comments_page.number }} of {{ comments_page.paginator.num_pages }}.
            </span>
          </li>
      
          {% if comments_page.has_next %}
            <li class="page-item">
              <a class="page-link" href="?comments={{ comments_page.next_page_number }}">Next</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?comments={{ comments_page.paginator.num_pages }}">{{ comments_page.paginator.num_pages }}</a>
            </li>
          {% endif %}
        </ul>
      </nav>

      <form method="POST" action="{% url 'flight_comment' flight.id %}">
        {% csrf_token %}
        <div class="mb-3">
          <label for="{{booking_form.message.id_for_label}}" class="form-label">Сообщение</label>
          <textarea name="message" class="form-control" id="{{booking_form.message.id_for_label}}" rows="3"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Отправить</button>
      </form>
    </div>
  </div>
{% endif %}

{% endblock %}
