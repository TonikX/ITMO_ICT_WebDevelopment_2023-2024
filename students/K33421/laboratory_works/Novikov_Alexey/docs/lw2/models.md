# Модели

Нам необходимо описать БД средствами Django ORM, для этого перейдём в файл `models.py` в нашем приложении и 
создадим несколько классов, наследуемых от `django.db.models.Model`.

Также внутри каждого класса создадим мета-класс с 3 полями:

- `db_table` - название таблицы в БД;
- `verbose_name` - человекочитаемое название объекта;
- `verbose_name_plural` - человекочитаемое название во множественном числе.

Кроме того, переопределим дандер-метод `__str__` в каждом классе, чтобы объекты имели более понятное текстовое представление.

=== "Авиакомпания"

    ```Python
    from django.db import models


    --8<-- "laboratory_work_2/flights/models.py:7:16"
    ```

    В этой модели определим только одно текстовое поле - "Название".

=== "Рейс"

    ```Python
    from django.db import models
    from django.utils import timezone


    --8<-- "laboratory_work_2/flights/models.py:19:38"
    ```
    
    В этой модели определим внешний ключ к таблице авиакомпаний и напишем `related_name` - `flights`. По этому имени мы 
    сможем обращаться к объектам рейсов из модели авиакомпаний.

    Создадим подкласс `Type`, наследуемый от `models.TextChoices`, аналог Enum в Django. В нём опишем два значения: 
    прилёт и отлёт, их значения, которые будет храниться в БД, и их человекочитаемые значения.

    Далее создадим в модели текстовое поле "Тип" и с помощью атрибута `choices` обеспечим связь с подклассом `Type`. 
    Это обеспечит валидацию данных для этого поля и возможность выбора в админ-панели.

    Помимо этого добавим текстовое поле "Гейт" и поле с датой и временем "Время отправления".

    В методе `__str__` из особенностей: `#!py3 self.get_type_display()`, с помощью которого мы можем получить человекочитаемое 
    название типа рейса, и `#!py3 timezone.localtime(self.date)`, с помощью которого мы получим дату и время в часовом поясе, 
    обозначенном в `settings.py` (по умолчанию в БД дата и время хранятся в UTC).

=== "Бронь"

    ```Python
    from django.contrib.auth.models import User
    from django.db import models


    --8<-- "laboratory_work_2/flights/models.py:41:54"
    ```

    В этой модели добавим два внешних ключа: на `User` (встроенная auth модель, которую мы будем использовать, 
    чтобы хранить пользователей) и `Flight` (рейс). Для обоих полей напишем `related_name="bookings"`

    А также булевое поле "Зарегистрирован?" (по умолчанию ставится как False), необходимое для подтверждения брони 
    администраторами, и PositiveSmallInteger поле "Номер билета", которое может быть числом в пределах от 0 до 32767 и 
    которое так же вводится администратором.

=== "Отзыв"

    ```Python
    from django.contrib.auth.models import User
    from django.core import validators
    from django.db import models


    --8<-- "laboratory_work_2/flights/models.py:57:72"
    ```

    В этом модели так же создаём два внешних ключа: на `User` и на `Flight` (в качестве `related_name` выберем `feedbacks`), 
    а также текстовое поле для текста отзывов, PositiveSmallInteger поле "Рейтинг" с валидаторами, 
    чтобы значение было от 1 до 10, и поле даты и времени, которое заполняется автоматически при создании записи.

После создания всех моделей нужно обязательно сделать миграции:

```commandline
python manage.py makemigrations
python manage.py migrate
```

А так же создать суперпользователя:

```commandline
python manage.py createsuperuser
```