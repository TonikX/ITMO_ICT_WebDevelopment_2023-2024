# Модели

Нам необходимо описать БД средствами Django ORM, для этого перейдём в файл `models.py` в наших приложениях и 
создадим несколько классов, наследуемых от `django.db.models.Model`.

Также внутри каждого класса создадим мета-класс с 3 полями:

- `db_table` - название таблицы в БД;
- `verbose_name` - человекочитаемое название объекта;
- `verbose_name_plural` - человекочитаемое название во множественном числе.

Кроме того, переопределим дандер-метод `__str__` в каждом классе, чтобы объекты имели более понятное текстовое представление.

=== "adapter"

    ```Python title="Адаптеры"
    from django.db import models


    --8<-- "laboratory_work_3/src/apps/adapter/models.py:4:14"
    ```

    В этой модели определим только два текстовых поля: фамилию и имя. Остальная информация этого приложения уже 
    имеется на проде, и она не нужна для работы опроса.

=== "oidc"

    ```Python title="Профили ITMO.ID"
    from django.contrib.auth.models import User
    from django.db import models

    --8<-- "laboratory_work_3/src/apps/oidc/models.py:5:18"
    ```
    
    В этой модели определим O2O связь к встроенной модели auth.User, чтобы расширить её дополнительной 
    необязательной информацией. Здесь будет храниться необходимая информация, полученная с ITMO.ID.

=== "survey"

    === "Группы"

        ```Python
        from django.db import models
    
    
        --8<-- "laboratory_work_3/src/apps/survey/models.py:4:15"
        ```
    
        В этой модели определим поле `name`, значения которого должны совпадать с тем, что возвращает ITMO.ID, для 
        дальнейшего сопоставления. Также укажем поле `students_count`, необходимое для дальнейшего подсчёта баллов для 
        каждого адаптера для оценивания на ПГАС. И привяжем с помощью M2M связи модель адаптеров так же для подсчёта 
        баллов и чтобы в опросе выводить только необходимых адаптеров.

    === "Факультеты"

        ```Python
        from django.db import models
    
    
        --8<-- "laboratory_work_3/src/apps/survey/models.py:18:28"
        ```
    
        В этой модели определим поле `name`, значения которого должны совпадать с тем, что возвращает ITMO.ID. И определим 
        булеое поле `is_active`, на которое будем ориентироваться для постепенного открытия опроса.

    === "Вопросы"

        ```Python
        from django.db import models
    
    
        --8<-- "laboratory_work_3/src/apps/survey/models.py:31:62"
        ```
    
        В этой модели определим текстовое поле 'component', допустимыми значениями которого будут названия кастомных 
        Vue.js компонентов, вынесенные в Djang Enum - TextChoices. Благодаря этому полю фронтенд сможет понять, какой 
        компонент отрисовывать для каждого вопроса.
        Даже добавим поля `text` и `help_text` для отображения надписи над компонентом крупным и мелким шрифтом, и 
        дополнительные поля `training_text` и `training_help_text` в случае использования компонента AdapterSelect, который 
        внутри себя создаёт два компонента, каждый из который нуждается в надписи.
        Также определим поле `order`, необходимое для сортировки в необходимом порядке.

    === "Ответы"

        ```Python
        from django.db import models
    
    
        --8<-- "laboratory_work_3/src/apps/survey/models.py:65:82"
        ```
    
        В этой модели укажем три внешних ключа: к встроенной модели auth.User, чтобы понимать, какой пользователь отправил 
        ответ, к модели Adapter, чтобы в случае компонента AdapterSlider понимать, какому именно адаптеру была поставлена оценка, 
        и к модели SurveyQuestion, чтобы понимать, на какой именно вопрос пришёл ответ.
        Также укажем два поля для хранения значений ответов, текстовое `value`, хранящее прямой ответ с "формы", и численное 
        `score`, хранящее адаптированное значение баллов.

После создания всех моделей нужно обязательно сделать миграции:

```commandline
python manage.py makemigrations
python manage.py migrate
```

А так же создать суперпользователя:

```commandline
python manage.py createsuperuser
```