# Отчёт по лабораторной работе


**Цель:** овладеть практическими навыками и умениями реализации web-сервисов средствами Django 3 и СУБД PostgreSQL.

**Оборудование:** компьютерный класс.

**Программное обеспечение:** Python 3.6+, Django 3, PostgreSQL*.

## Практическое задание

**Вариант 6: Табло победителей автогонок**

Табло должно отображать информацию об участниках автогонок, включая следующие данные:

- ФИО участника
- Название команды
- Описание автомобиля
- Описание участника
- Опыт
- Класс участника

Необходимо реализовать следующий функционал:

1. **Регистрация новых пользователей.** Пользователи могут регистрироваться на сайте.

2. **Просмотр автогонок и регистрацию гонщиков.** Пользователи могут просматривать информацию о предстоящих автогонках и
   регистрироваться в качестве участников. Пользователи имеют возможность редактирования и удаления своих регистраций.

3. **Написание отзывов и комментариев к автогонкам.** Пользователи могут оставлять отзывы и комментарии к автогонкам.
   Для этого комментаторы должны зарегистрироваться. При добавлении комментариев сохраняются следующие данные: дата
   заезда, текст комментария, тип комментария (вопрос о сотрудничестве, вопрос о гонках, иное), рейтинг (1-10),
   информация о комментаторе.

4. **Администраторская панель.** Администратор может указать время заезда и результаты средствами Django-admin.

5. **Клиентская часть.** В клиентской части должна формироваться таблица всех заездов и результатов конкретной гонки.

---

Для создания нового Django проекта была использована команда "django-admin startproject race_project". Эта команда
создает каталог с именем "race_project", который будет содержать весь проект.
Для создания нового Django приложения, в данном случае "races", была использована команда "python manage.py startapp
races".

Для реализации табло победителей гонок с описанным функционалом, создадим модели для хранения информации о
пользователях, гонках, регистрациях участников, отзывах и комментариях.

В файле `models.py` определены модели данных для Django-приложения. Эти модели описывают структуру базы данных,
включая таблицы и связи между ними. Весь код написан на языке программирования Python с использованием Django-фреймворка
для веб-разработки.

### `Team`

- Описание: Модель `Team` представляет собой таблицу для хранения информации о командах.
- Поля:
    - `name` (CharField): Название команды (максимум 100 символов).
- Методы:
    - `__str__`: Возвращает строковое представление команды (название).

### `Racer`

- Описание: Модель `Racer` представляет собой таблицу для хранения информации о гонщиках.
- Поля:
    - `user` (OneToOneField): Связь с моделью `User` для связи с пользователем Django.
    - `team` (ForeignKey): Связь с моделью `Team` для указания команды гонщика. Может быть пустым (null=True).
    - `description` (TextField): Описание гонщика.
    - `experience` (IntegerField): Опыт гонщика (целое число).
- Методы:
    - `__str__`: Возвращает строковое представление гонщика (имя пользователя).

### `Race`

- Описание: Модель `Race` представляет собой таблицу для хранения информации о гонках.
- Поля:
    - `name` (CharField): Название гонки (максимум 100 символов).
    - `date` (DateTimeField): Дата и время проведения гонки.
    - `winner` (ForeignKey): Связь с моделью `Team` для указания победителя гонки. Может быть пустым (null=True).
- Методы:
    - `__str__`: Возвращает строковое представление гонки (название).

### `RaceEntry`

- Описание: Модель `RaceEntry` представляет собой таблицу для хранения информации о участии гонщика в гонке.
- Поля:
    - `racer` (ForeignKey): Связь с моделью `Racer` для указания гонщика.
    - `race` (ForeignKey): Связь с моделью `Race` для указания гонки.

### `Comment`

- Описание: Модель `Comment` представляет собой таблицу для хранения информации о комментариях к гонкам.
- Поля:
    - `race` (ForeignKey): Связь с моделью `Race` для указания гонки, к которой оставлен комментарий.
    - `author` (ForeignKey): Связь с моделью `User` для указания автора комментария.
    - `text` (TextField): Текст комментария.
    - `comment_type` (CharField): Тип комментария (выбор из предопределенных значений).
    - `rating` (IntegerField): Рейтинг комментария (целое число) с ограничениями от 1 до 10.
    - `created_at` (DateTimeField): Дата и время создания комментария.
- Методы:
    - `__str__`: Возвращает строковое представление комментария (автор, тип и название гонки).


В файле `admin.py` каждой Django-приложения определяются настройки административного интерфейса для моделей, которые создали в этом приложении. Файл `admin.py` позволяет вам настраивать, как модели будут отображаться и редактироваться в административной панели Django.

В этом файле, я использовала декоратор `@admin.register(Model)`, чтобы зарегистрировать каждую из моделей (`Team`, `Racer`, `Race`, `RaceEntry`, `Comment`) в административной панели. Затем я определила подклассы для каждой из этих моделей, которые наследуются от `admin.ModelAdmin`.

Далее, внутри каждого из этих подклассов `ModelAdmin`, я определила различные атрибуты, чтобы настроить отображение и функциональность для каждой модели:

- `list_display` указывает, какие поля модели будут отображаться в списке записей в административной панели.
- `list_filter` добавляет фильтры в боковой панели для удобной фильтрации записей.

В файле `forms.py` определены различные формы для работы с данными, их валидации и представления. Вот краткое описание этого файла:

`RegistrationForm` - это форма для регистрации пользователей. Она наследуется от `UserCreationForm` и добавляет поле `email` для ввода email-адреса пользователя.

`CommentForm` - форма для создания комментариев. Она связана с моделью `Comment` и содержит поля `comment_type`, `rating` и `text` для ввода информации о комментарии.

`ProfileUpdateForm` - это форма для обновления профиля пользователя. Она наследуется от `UserChangeForm` и содержит поля, связанные с моделью `User`, такие как `username` и `email`, а также дополнительные поля, такие как `team`, `description` и `experience`. Форма также содержит поля для изменения пароля: `current_password`, `new_password` и `new_password_confirm`.

   - В этой форме также определен метод `__init__`, который заполняет начальные значения для полей, основываясь на существующей информации в профиле пользователя.
   - Есть также метод `clean`, который выполняет дополнительную валидацию полей, связанных с изменением пароля, и проверяет правильность введенного текущего пароля, а также совпадение новых паролей.

`PasswordChangeCustomForm` - форма для изменения пароля пользователя. Она наследуется от `PasswordChangeForm` и содержит поля для ввода текущего пароля (`old_password`), нового пароля (`new_password1`) и подтверждения нового пароля (`new_password2`).

В файле `views.py` определены представления (view functions), которые определяют, как данные отображаются и обрабатываются веб-страницами в вашем Django-приложении.

`user_register(request)` - представление для регистрации новых пользователей. Если запрос отправлен методом POST, то форма `RegistrationForm` обрабатывает данные. Если данные валидны, новый пользователь создается, и пользователь автоматически входит в систему. В противном случае выводятся ошибки формы. Если запрос отправлен методом GET, форма для регистрации просто отображается.

`base(request)` - представление для отображения базовой страницы (по-видимому, стартовой страницы). Оно просто возвращает страницу "base.html".

`tablo(request)` - представление для отображения списка гонок. Оно получает список всех гонок из модели `Race` и передает их на страницу "tablo.html".

`comments(request, race_id)` - представление для отображения комментариев к конкретной гонке. Оно получает гонку по ее идентификатору и соответствующие комментарии. Если запрос отправлен методом POST, форма `CommentForm` обрабатывает данные. Если данные валидны, создается новый комментарий. В любом случае, форма отображается на странице.

`handle_form_errors(request, form)` - функция, которая обрабатывает ошибки формы и выводит их как сообщения.

`user_logout(request)` - представление для выхода пользователя из системы. Оно использует функцию `logout` для завершения текущей сессии пользователя и перенаправляет его на страницу "base".

`profile(request)` - представление для отображения и обновления профиля пользователя. Если запрос отправлен методом POST и содержит данные для изменения пароля, форма `PasswordChangeCustomForm` обрабатывает их. Если данные валидны, пароль пользователя изменяется. Если запрос отправлен методом POST и содержит данные для обновления профиля, форма `ProfileUpdateForm` обрабатывает их. Если данные валидны, информация о профиле обновляется. Это представление также использует `messages` для вывода сообщений об успехе или ошибке.

В HTML-файлах определены разметка и шаблоны веб-страниц, которые определяют, как содержимое будет отображаться для пользователей.

1. **user_registration.html**: Это страница регистрации пользователей. Она содержит форму для ввода имени пользователя, адреса электронной почты и пароля. 

2. **base.html**: Это базовый шаблон для других страниц вашего веб-приложения. Он содержит общую разметку, такую как шапка сайта или меню навигации.

3. **tablo.html**: Это страница для отображения списка гонок. Список гонок отображается на этой странице, и пользователи могут просматривать информацию о гонках.

4. **comments.html**: Это страница для отображения комментариев к конкретной гонке. На странице можно видеть комментарии пользователей, а также оставлять свои собственные комментарии.

5. **profile.html**: Это страница для отображения профиля пользователя и внесения изменений в профиль.

6. **login.html**: Это страница для отображения входа зарегистрированного пользователя в приложении.

Файл `urls.py` представляет собой модуль маршрутизации (routing) Django-приложения. Он определяет, какие URL-адреса будут доступны в приложении и какие представления (views) будут связаны с этими URL-адресами.

Для запуска сервера Django нужно использовать команду:

```
python manage.py runserver
```

Здесь `manage.py` - это скрипт управления Django проектом. Команда `runserver` запустит локальный разработческий сервер Django. Эта команда запустит сервер на порту 8080.

## Вывод:
Приложение предоставляет базовую функциональность для организации гонок и управления данными гонщиков. Оно хорошо структурировано и использует стандартные практики разработки Django.
